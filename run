#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

show_help() {
    cat << EOF
Usage: ./run <command>

Commands:
  build           Build the TypeScript project
  build:watch     Build with watch mode
  test            Run tests
  test:watch      Run tests in watch mode
  test:coverage   Run tests with coverage
  lint            Run ESLint
  lint:fix        Run ESLint with auto-fix
  format          Format code with Prettier
  format:check    Check formatting
  typecheck       Run TypeScript type checking
  ci              Run all CI checks (typecheck, lint, format:check, test)
  hooks-install   Install lefthook pre-commit hooks
  help            Show this help message

EOF
}

case "${1:-help}" in
    build)
        npm run build
        ;;
    build:watch)
        npm run build:watch
        ;;
    test)
        npm run test
        ;;
    test:watch)
        npm run test:watch
        ;;
    test:coverage)
        npm run test:coverage
        ;;
    lint)
        npm run lint
        ;;
    lint:fix)
        npm run lint:fix
        ;;
    format)
        npm run format
        ;;
    format:check)
        npm run format:check
        ;;
    typecheck)
        npm run typecheck
        ;;
    ci)
        npm run ci
        ;;
    hooks-install)
        npx lefthook install
        ;;
    help|--help|-h)
        show_help
        ;;
    *)
        echo "Unknown command: $1"
        show_help
        exit 1
        ;;
esac
